<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viaggio Interattivo nei Balcani</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals with Sky Blue and Teal Accents -->
    <!-- Application Structure Plan: A single-page, vertically-scrolling application organized into five logical sections: 1. An introductory Hero section with key stats. 2. A new "Route Map" section providing a visual overview of the entire journey. 3. An interactive, clickable timeline as the main navigation for the day-by-day itinerary, now including distances between stops. This is more engaging than a static list and provides a clear user flow. 4. A "Dashboard" section with two charts (days per country, driving times) to visually summarize quantitative data. 5. A final "Logistics" section using an accordion for detailed driving info, making a large amount of text manageable. This structure transforms the linear report into an explorable, user-friendly SPA, adding geographic context and trip metrics. -->
    <!-- Visualization & Content Choices: Report data is presented through various interactive methods. Route Map -> Goal: Overview -> Viz: Placeholder image map (placehold.co) -> Interaction: Visual representation. Itinerary -> Goal: Organize/Explore -> Viz: Interactive vertical timeline (HTML/CSS/JS) with images for each day and now distance details -> Interaction: Click to reveal day details, plus an AI-powered suggestion button to generate extra tips per day. Driving Times -> Goal: Compare -> Viz: Bar Chart (Chart.js) -> Interaction: Tooltips on hover. Day Distribution -> Goal: Inform -> Viz: Donut Chart (Chart.js) -> Interaction: Tooltips on hover. Driving Rules -> Goal: Organize/Inform -> Viz: Accordion (HTML/JS) -> Interaction: Click to expand/collapse country info. This approach ensures all key information is presented interactively and effectively, with added AI enhancement and crucial travel metrics. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fdfbf7;
            color: #374151;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .timeline-item-content {
            transition: max-height 0.7s ease-in-out, opacity 0.5s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .timeline-item-content.active {
            max-height: 1000px; /* Adjusted to fit larger content like images and suggestions */
            opacity: 1;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #38bdf8;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <!-- Sezione Titolo e Introduzione -->
        <header class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold text-sky-900 mb-4">La Tua Avventura On The Road nei Balcani</h1>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">Un'esplorazione interattiva del tuo viaggio di 17 giorni da Milano, attraverso 6 paesi, fino alle coste dell'Albania e ritorno. Clicca su ogni giorno per svelare i dettagli dell'itinerario.</p>
        </header>

        <!-- Sezione Mappa del Percorso -->
        <section id="route-map" class="mb-20">
            <h2 class="text-3xl font-bold text-center text-sky-800 mb-2">Mappa del Tuo Percorso</h2>
            <p class="text-center text-gray-500 mb-12">Questa mappa ti offre una panoramica visiva di tutte le tappe del tuo viaggio attraverso i Balcani. Le linee indicano il percorso generale che seguirai da Milano a Vlor√´ e ritorno a Bari.</p>
            <div class="flex justify-center">
                <img src="https://placehold.co/800x500/0ea5e9/ffffff?text=Mappa+del+Percorso+Balcanico" alt="Mappa del percorso nei Balcani" class="w-full max-w-3xl rounded-lg shadow-lg">
            </div>
        </section>

        <!-- Sezione Dashboard Riepilogativa -->
        <section id="dashboard" class="mb-20">
             <h2 class="text-3xl font-bold text-center text-sky-800 mb-2">Il Viaggio in Numeri</h2>
             <p class="text-center text-gray-500 mb-12">Questa sezione offre una visione d'insieme del viaggio attraverso grafici interattivi. Puoi visualizzare come sono distribuiti i giorni tra i vari paesi e una stima dei tempi di guida per le tratte principali, aiutandoti a comprendere meglio il ritmo e l'impegno del percorso.</p>
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div>
                    <h3 class="text-xl font-semibold text-center text-gray-700 mb-4">Giorni di Pernottamento per Paese</h3>
                    <div class="chart-container">
                        <canvas id="daysPerCountryChart"></canvas>
                    </div>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-center text-gray-700 mb-4">Tempi di Guida Stimati (ore)</h3>
                    <div class="chart-container">
                        <canvas id="drivingTimesChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sezione Itinerario Interattivo -->
        <section id="itinerary">
            <h2 class="text-3xl font-bold text-center text-sky-800 mb-2">Itinerario Giorno per Giorno</h2>
             <p class="text-center text-gray-500 mb-12">Questa √® la guida interattiva del tuo viaggio. Il percorso √® rappresentato come una linea del tempo. Clicca sul titolo di ogni giorno per espandere e visualizzare i dettagli della tappa, incluse le principali attrazioni e le attivit√† previste. Premi il pulsante "‚ú® Ottieni Suggerimenti ‚ú®" per ricevere consigli extra generati dall'AI.</p>
            <div id="timeline-container" class="relative">
                <!-- La timeline verr√† generata dinamicamente da JavaScript -->
            </div>
        </section>

        <!-- Sezione Informazioni Logistiche -->
        <section id="logistics" class="mt-20">
            <h2 class="text-3xl font-bold text-center text-sky-800 mb-2">Informazioni Essenziali per la Guida</h2>
            <p class="text-center text-gray-500 mb-12">Qui trovi un riepilogo delle normative e dei requisiti di guida per ogni paese che attraverserai. Clicca su un paese per espandere e leggere le informazioni specifiche, come documenti necessari ed equipaggiamento obbligatorio per l'auto.</p>
            <div id="accordion-container" class="max-w-4xl mx-auto">
                <!-- L'accordion verr√† generato dinamicamente da JavaScript -->
            </div>
        </section>
        
        <footer class="text-center mt-16 text-gray-500">
            <p>Buon viaggio!</p>
        </footer>

    </div>

    <script>
        const itineraryData = [
            { day: 1, date: "1 Ago", from: "Milano", to: "Lago di Bled", title: "Da Milano al Cuore delle Alpi Giulie", details: "Partenza da Milano verso la Slovenia. Arrivo al Lago di Bled, famoso per la sua isola pittoresca e il castello medievale. Esplorazione del lago e pernottamento in zona.", icons: "üèûÔ∏èüè∞", type: "natura", imageUrl: "https://placehold.co/600x400/0c4a6e/ffffff?text=Lago+di+Bled", distanceFromPrevious: "Partenza" },
            { day: 2, date: "2 Ago", from: "Lago di Bled", to: "Ljubljana", title: "Natura e Capitale Slovena", details: "Mattinata dedicata alla Vintgar Gorge. Pomeriggio trasferimento a Ljubljana per esplorare il centro storico, il castello e le rive del fiume Ljubljanica.", icons: "üèûÔ∏èüèôÔ∏è", type: "misto", imageUrl: "https://placehold.co/600x400/0369a1/ffffff?text=Ljubljana", distanceFromPrevious: "60 km" },
            { day: 3, date: "3 Ago", from: "Ljubljana", to: "Plitvice", title: "Meraviglie Naturali Croate", details: "Trasferimento in Croazia al Parco Nazionale dei Laghi di Plitvice. Intera giornata dedicata all'esplorazione dei 16 laghi e delle numerose cascate del parco, patrimonio UNESCO.", icons: "üèûÔ∏èüíß", type: "natura", imageUrl: "https://placehold.co/600x400/0ea5e9/ffffff?text=Laghi+di+Plitvice", distanceFromPrevious: "200 km" },
            { day: 4, date: "4 Ago", from: "Plitvice", to: "Split", title: "Verso la Costa Dalmata", details: "Viaggio verso Split. Esplorazione del Palazzo di Diocleziano, della Cattedrale di San Doimo e della vivace passeggiata Riva.", icons: "üèõÔ∏èüåä", type: "citta", imageUrl: "https://placehold.co/600x400/38bdf8/ffffff?text=Split", distanceFromPrevious: "250 km" },
            { day: 5, date: "5 Ago", from: "Split", to: "Dubrovnik", title: "Il Gioiello dell'Adriatico", details: "Proseguimento lungo la costa fino a Dubrovnik. Passeggiata sulle imponenti mura della citt√†, visita dello Stradun, il Palazzo del Rettore e la Fortezza Lovrijenac.", icons: "üè∞üåä", type: "citta", imageUrl: "https://placehold.co/600x400/7dd3fc/ffffff?text=Dubrovnik", distanceFromPrevious: "230 km" },
            { day: 6, date: "6 Ago", from: "Dubrovnik", to: "Mostar", title: "Incursione in Bosnia: Mostar", details: "Ingresso in Bosnia ed Erzegovina. Visita di Mostar, con il suo iconico Stari Most (Ponte Vecchio). Tuffo rinfrescante alle vicine Kravica Waterfalls e visita al Blagaj Tekke.", icons: "üåâüíß", type: "misto", imageUrl: "https://placehold.co/600x400/0c4a6e/ffffff?text=Mostar", distanceFromPrevious: "140 km" },
            { day: 7, date: "7 Ago", from: "Mostar", to: "Kotor", title: "La Baia di Kotor in Montenegro", details: "Arrivo a Kotor, Montenegro. Esplorazione della citt√† vecchia (UNESCO), salita alla Fortezza di San Giovanni per una vista mozzafiato e gita al villaggio di Perast e a Our Lady of the Rocks.", icons: "üèûÔ∏èüè∞", type: "misto", imageUrl: "https://placehold.co/600x400/0369a1/ffffff?text=Kotor", distanceFromPrevious: "170 km" },
            { day: 8, date: "8 Ago", from: "Kotor", to: "Shkod√´r", title: "Benvenuti in Albania", details: "Ingresso in Albania e arrivo a Shkod√´r. Visita al Castello di Rozafa, con vista panoramica sul lago, e passeggiata nel centro storico e nel bazaar.", icons: "üè∞üèôÔ∏è", type: "citta", imageUrl: "https://placehold.co/600x400/0ea5e9/ffffff?text=Shkodra", distanceFromPrevious: "100 km" },
            { day: 9, date: "9 Ago", from: "Shkod√´r", to: "Berat", title: "Tirana e la 'Citt√† delle Mille Finestre'", details: "Breve tappa a Tirana, la capitale, per vedere Skanderbeg Square. Proseguimento per Berat (UNESCO), esplorazione del castello e del quartiere di Mangalem.", icons: "üèôÔ∏èüèòÔ∏è", type: "citta", imageUrl: "https://placehold.co/600x400/38bdf8/ffffff?text=Berat", distanceFromPrevious: "150 km" },
            { day: 10, date: "10 Ago", from: "Berat", to: "Gjirokast√´r", title: "Il Blue Eye e la 'Citt√† di Pietra'", details: "Viaggio verso sud. Tappa obbligatoria al Blue Eye (Syri i Kalt√´r), una sorgente naturale mozzafiato. Arrivo a Gjirokast√´r (UNESCO) per visitare il castello e il bazaar.", icons: "üíßüè∞", type: "natura", imageUrl: "https://placehold.co/600x400/7dd3fc/ffffff?text=Blue+Eye+e+Gjirokaster", distanceFromPrevious: "160 km" },
            { day: 11, date: "11 Ago", from: "Gjirokast√´r", to: "Sarand√´", title: "Riviera Albanese: Storia e Spiagge", details: "Direzione costa. Visita al sito archeologico di Butrint (UNESCO). Relax sulle splendide spiagge di Ksamil e arrivo a Sarand√´.", icons: "üèõÔ∏èüèñÔ∏è", type: "mare", imageUrl: "https://placehold.co/600x400/0c4a6e/ffffff?text=Saranda+e+Butrint", distanceFromPrevious: "70 km" },
            { day: 12, date: "12 Ago", from: "Sarand√´", to: "Himara/Dh√´rmi", title: "La Perla della Riviera Albanese (Giorno 1)", details: "Primo giorno interamente dedicato all'esplorazione delle spiagge di Himara, Dh√´rmi e Gjipe, godendo del mare cristallino e del paesaggio mozzafiato.", icons: "üèñÔ∏èüåä", type: "mare", imageUrl: "https://placehold.co/600x400/0369a1/ffffff?text=Himara+Dh%C3%ABrmi", distanceFromPrevious: "70 km" },
            { day: 13, date: "13 Ago", from: "Himara/Dh√´rmi", to: "Himara/Dh√´rmi", title: "La Perla della Riviera Albanese (Giorno 2)", details: "Secondo giorno per continuare a esplorare le spiagge pi√π belle, immergendosi nella natura e nel relax. Possibilit√† di fare snorkeling o escursioni locali.", icons: "üèñÔ∏èüåä", type: "mare", imageUrl: "https://placehold.co/600x400/0ea5e9/ffffff?text=Gjipe+Beach", distanceFromPrevious: "Locale" },
            { day: 14, date: "14 Ago", from: "Himara/Dh√´rmi", to: "Vlor√´", title: "Risalita Panoramica verso Vlor√´", details: "Viaggio lungo la spettacolare strada costiera, attraversando il Passo di Llogara con le sue viste mozzafiato sul Mar Ionio. Arrivo a Vlor√´ nel pomeriggio.", icons: "üöóüèûÔ∏è", type: "misto", imageUrl: "https://placehold.co/600x400/38bdf8/ffffff?text=Passo+di+Llogara", distanceFromPrevious: "60 km" },
            { day: 15, date: "15 Ago", from: "Vlor√´", to: "Vlor√´", title: "Esplorazione di Vlor√´", details: "Giornata dedicata a Vlor√´: visita al Monumento all'Indipendenza, alla Moschea Muradie e relax sul lungomare. Preparazione per la partenza serale del giorno dopo.", icons: "üèõÔ∏èüèôÔ∏è", type: "citta", imageUrl: "https://placehold.co/600x400/7dd3fc/ffffff?text=Vlora", distanceFromPrevious: "Locale" },
            { day: 16, date: "16 Ago", from: "Vlor√´", to: "Bari", title: "Vlor√´ e Traghetto Notturno per Bari", details: "Ultima mattinata a Vlor√´. Tempo per ultime visite o relax. In serata, imbarco sul traghetto notturno per Bari. √à fondamentale aver prenotato il biglietto con largo anticipo!", icons: "üö¢üåô", type: "viaggio", imageUrl: "https://placehold.co/600x400/0c4a6e/ffffff?text=Traghetto+Vlor%C3%AB+Bari", distanceFromPrevious: "230 km (mare)" },
            { day: 17, date: "17 Ago", from: "Bari", to: "Milano", title: "Rientro a Casa", details: "Arrivo a Bari in mattinata e lungo viaggio di ritorno in auto verso Milano. Fine dell'avventura.", icons: "üöóüè†", type: "viaggio", imageUrl: "https://placehold.co/600x400/0369a1/ffffff?text=Milano", distanceFromPrevious: "850 km" },
        ];

        const drivingData = {
            labels: ['MI-Bled', 'LJU-Plitvice', 'DBV-Mostar', 'Mostar-Kotor', 'Kotor-Shkod√´r', 'Gjirokast√´r-Vlor√´', 'Bari-MI'],
            data: [5, 3.5, 3, 3, 2, 3.5, 8.5]
        };

        const countryDaysData = {
            labels: ['Slovenia', 'Croazia', 'Bosnia', 'Montenegro', 'Albania'],
            data: [2, 3, 1, 1, 10]
        };
        
        const logisticsData = [
            { country: 'Slovenia', content: '<b>Vignetta:</b> Elettronica, obbligatoria per autostrade. Acquistare online prima di entrare. <b>Equipaggiamento:</b> Triangolo, giubbotto riflettente, kit pronto soccorso, lampadine di ricambio.'},
            { country: 'Croazia', content: '<b>Pedaggi:</b> Si paga ai caselli in base alla distanza (NO vignetta per il 2025). <b>Equipaggiamento:</b> Triangolo, giubbotto riflettente.'},
            { country: 'Bosnia ed Erzegovina', content: '<b>Pedaggi:</b> Rete autostradale limitata con pedaggi ai caselli. <b>Regole:</b> Fari anabbaglianti sempre accesi. Carta Verde non pi√π richiesta. <b>Equipaggiamento:</b> Kit completo, estintore raccomandato.'},
            { country: 'Montenegro', content: '<b>Pedaggi:</b> Nessun pedaggio autostradale eccetto il tunnel di Sozina. <b>Regole:</b> Fari anabbaglianti sempre accesi. Carta Verde non pi√π richiesta. <b>Equipaggiamento:</b> Kit completo.'},
            { country: 'Albania', content: '<b>Permesso Guida Internazionale (IDP):</b> Fortemente raccomandato per evitare problemi. <b>Pedaggi:</b> Presenti su alcune autostrade principali (es. A1). <b>Regole:</b> Stile di guida locale pu√≤ essere aggressivo, guidare con prudenza. <b>Equipaggiamento:</b> Kit completo, estintore raccomandato.'}
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const timelineContainer = document.getElementById('timeline-container');
            let timelineHTML = '<div class="absolute top-0 left-1/2 -ml-0.5 w-1 h-full bg-sky-200"></div>';
            
            itineraryData.forEach((item, index) => {
                const sideClass = index % 2 === 0 ? 'md:pr-8' : 'md:pl-8 md:text-right';
                const marginClass = index % 2 === 0 ? '' : 'md:ml-auto';

                timelineHTML += `
                <div class="timeline-item mb-8 flex flex-col items-center md:items-stretch" data-day="${item.day}">
                    <div class="w-full md:w-1/2 ${sideClass} relative">
                        <div class="absolute top-1/2 -mt-3 hidden md:block ${index % 2 === 0 ? 'right-0 -mr-3.5' : 'left-0 -ml-3.5'}">
                            <div class="w-8 h-8 rounded-full bg-sky-600 border-4 border-white flex items-center justify-center text-white font-bold">${item.day}</div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 cursor-pointer timeline-item-header">
                            <div class="flex justify-between items-center">
                                <span class="text-4xl mr-4">${item.icons}</span>
                                <div class="flex-grow text-left">
                                    <p class="text-sm font-semibold text-sky-700">${item.date} - Giorno ${item.day}</p>
                                    <h3 class="text-xl font-bold text-gray-800">${item.title}</h3>
                                </div>
                                <span class="text-2xl text-gray-400 transform transition-transform duration-300 arrow-indicator">‚ñº</span>
                            </div>
                            <div class="timeline-item-content mt-4 text-left">
                                <!-- Nota: Le immagini sottostanti sono segnaposto. Per avere foto reali, dovresti sostituire gli URL con quelli di immagini ospitate pubblicamente. -->
                                <img src="${item.imageUrl}" alt="Immagine di ${item.title}" class="w-full h-auto rounded-lg mb-4 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/CCCCCC/FFFFFF?text=Immagine+non+disponibile';">
                                <p class="text-gray-600 mb-2">${item.details}</p>
                                <p class="text-gray-600 font-semibold mb-2">Distanza precedente: ${item.distanceFromPrevious}</p>
                                <button class="gemini-suggestions-btn mt-4 px-4 py-2 bg-sky-500 text-white rounded-md hover:bg-sky-600 transition-colors duration-200 text-sm font-semibold">‚ú® Ottieni Suggerimenti ‚ú®</button>
                                <div class="gemini-suggestions-output mt-4 p-3 bg-blue-50 rounded-lg text-sm text-gray-700 hidden">
                                    <div class="loading-spinner mx-auto hidden"></div>
                                    <p class="suggestions-text"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            });
            timelineContainer.innerHTML = timelineHTML;

            // Accordion per logistica
            const accordionContainer = document.getElementById('accordion-container');
            let accordionHTML = '';
            logisticsData.forEach((item, index) => {
                accordionHTML += `
                <div class="mb-2">
                    <button class="accordion-header w-full text-left bg-white p-4 rounded-lg shadow-sm hover:bg-sky-50 transition-colors duration-200 flex justify-between items-center">
                        <span class="font-semibold text-lg text-gray-700">${item.country}</span>
                        <span class="text-xl text-gray-500 transform transition-transform duration-300">‚ñº</span>
                    </button>
                    <div class="accordion-content bg-white p-4 rounded-b-lg overflow-hidden max-h-0 transition-all duration-500 ease-in-out">
                        <p class="text-gray-600">${item.content}</p>
                    </div>
                </div>
                `;
            });
            accordionContainer.innerHTML = accordionHTML;


            // Event listener per la timeline
            document.querySelectorAll('.timeline-item-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.querySelector('.timeline-item-content');
                    const arrow = header.querySelector('.arrow-indicator');
                    
                    document.querySelectorAll('.timeline-item-content.active').forEach(openContent => {
                        if (openContent !== content) {
                            openContent.classList.remove('active');
                            openContent.closest('.timeline-item-header').querySelector('.arrow-indicator').classList.remove('rotate-180');
                        }
                    });

                    content.classList.toggle('active');
                    arrow.classList.toggle('rotate-180');
                });
            });

            // Event listener per accordion
            document.querySelectorAll('.accordion-header').forEach(button => {
                button.addEventListener('click', () => {
                    const content = button.nextElementSibling;
                    const arrow = button.querySelector('span:last-child');
                    
                    document.querySelectorAll('.accordion-content').forEach(c => {
                       if (c !== content && c.style.maxHeight !== '0px') {
                           c.style.maxHeight = '0px';
                           c.previousElementSibling.querySelector('span:last-child').classList.remove('rotate-180');
                       } 
                    });

                    if (content.style.maxHeight && content.style.maxHeight !== '0px') {
                        content.style.maxHeight = '0px';
                        arrow.classList.remove('rotate-180');
                    } else {
                        content.style.maxHeight = content.scrollHeight + 'px';
                        arrow.classList.add('rotate-180');
                    }
                });
            });

            // Gemini API Integration
            const apiKey = ""; 

            async function getGeminiSuggestions(dayData, outputDiv) {
                const spinner = outputDiv.querySelector('.loading-spinner');
                const suggestionsText = outputDiv.querySelector('.suggestions-text');

                outputDiv.classList.remove('hidden');
                spinner.classList.remove('hidden');
                suggestionsText.textContent = ''; // Clear previous suggestions

                const prompt = `Sei un esperto di viaggi. Basandoti su questa tappa del viaggio: 'Giorno ${dayData.day}: ${dayData.title}. Dettagli: ${dayData.details}. Tipo di tappa: ${dayData.type}.', suggerisci 2-3 attivit√† extra, luoghi da visitare o consigli culinari brevi e interessanti per questa localit√†. Sii conciso e pratico.`;

                try {
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        suggestionsText.textContent = result.candidates[0].content.parts[0].text;
                    } else {
                        suggestionsText.textContent = 'Nessun suggerimento disponibile al momento. Riprova pi√π tardi.';
                    }
                } catch (error) {
                    console.error('Errore durante la generazione dei suggerimenti:', error);
                    suggestionsText.textContent = 'Errore nel caricamento dei suggerimenti. Riprova.';
                } finally {
                    spinner.classList.add('hidden');
                }
            }

            document.querySelectorAll('.gemini-suggestions-btn').forEach((button, index) => {
                button.addEventListener('click', () => {
                    const dayData = itineraryData[index];
                    const outputDiv = button.nextElementSibling; // The div right after the button
                    getGeminiSuggestions(dayData, outputDiv);
                });
            });


            // Grafico Giorni per Paese
            new Chart(document.getElementById('daysPerCountryChart'), {
                type: 'doughnut',
                data: {
                    labels: countryDaysData.labels,
                    datasets: [{
                        label: 'Giorni per Paese',
                        data: countryDaysData.data,
                        backgroundColor: ['#0c4a6e', '#0369a1', '#0ea5e9', '#38bdf8', '#7dd3fc'],
                        borderColor: '#fdfbf7',
                        borderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed + ' giorni';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            // Grafico Tempi di Guida
            new Chart(document.getElementById('drivingTimesChart'), {
                type: 'bar',
                data: {
                    labels: drivingData.labels,
                    datasets: [{
                        label: 'Ore di guida stimate',
                        data: drivingData.data,
                        backgroundColor: '#38bdf8',
                        borderColor: '#0ea5e9',
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                         tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.x + ' ore';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                             title: {
                                display: true,
                                text: 'Ore'
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
